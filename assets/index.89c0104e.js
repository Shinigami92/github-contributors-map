import{c as v,a as t,n as j,F as S,r as U,o as g,b as L,d as x,e as b,w as C,v as P,S as B,P as H,W as V,O as W,T as Y,f as K,M as J,g as N,h as z,A as Q,i as X,j as E,C as Z,k as ee,V as te,l as O,m as oe,p as ne,q as G,t as w,s as q,u as re}from"./vendor.c41a165a.js";import{graphql as A}from"https://cdn.skypack.dev/@octokit/graphql";const se=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function l(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=l(o);fetch(o.href,c)}};se();const ae="modulepreload",D={},ie="/github-contributors-map/",le=function(n,l){return!l||l.length===0?n():Promise.all(l.map(a=>{if(a=`${ie}${a}`,a in D)return;D[a]=!0;const o=a.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const i=document.createElement("link");if(i.rel=o?"stylesheet":ae,o||(i.as="script",i.crossOrigin=""),i.href=a,document.head.appendChild(i),o)return new Promise((m,d)=>{i.addEventListener("load",m),i.addEventListener("error",d)})})).then(()=>n())},ce={class:"relative"},de=["src","width","height"];function ue(e,n,l,a,o,c){return g(),v("div",ce,[t("img",{class:"relative",src:"https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg",style:j({width:`${e.width}px`,height:`${e.height}px`})},null,4),(g(!0),v(S,null,U(e.users,i=>(g(),v(S,{key:i.id},[i.geolocation?(g(),v("img",{key:0,class:"absolute",src:i.avatarUrl,style:j({top:`${e.inverseLerp(90,-90,i.geolocation.lat)*e.height-e.avatarSize/2}px`,left:`${e.inverseLerp(-180,180,i.geolocation.lng)*e.width-e.avatarSize/2}px`}),width:e.avatarSize,height:e.avatarSize},null,12,de)):L("",!0)],64))),128))])}var R=(e,n)=>{for(const[l,a]of n)e[l]=a;return e};const pe=x({name:"FlatMap",props:{users:{type:Array,required:!0}},setup(){const e=b(960),n=b(483),l=b(24);return{width:e,height:n,avatarSize:l,inverseLerp:(o,c,i)=>(i-o)/(c-o)}}});var he=R(pe,[["render",ue]]);const me={class:"flex flex-col"},ge=t("div",{id:"canvas"},null,-1),fe={class:"mt-2"},ve=t("label",{for:"rotation-speed"},"Rotation speed:",-1);function be(e,n,l,a,o,c){return g(),v("div",me,[ge,t("div",fe,[ve,C(t("input",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1",id:"rotation-speed","onUpdate:modelValue":n[0]||(n[0]=i=>e.rotationSpeed=i),name:"rotation-speed",type:"number",placeholder:"0.001",step:"0.0001"},null,512),[[P,e.rotationSpeed,void 0,{number:!0}]])])])}function ye(e,n,l){const a=(90-n)*(Math.PI/180),o=(l+180)*(Math.PI/180),c=new te;return c.x=-(e*Math.sin(a)*Math.cos(o)),c.z=e*Math.sin(a)*Math.sin(o),c.y=e*Math.cos(a),c}const we=x({name:"ThreeCanvas",props:{users:{type:Array,required:!0}},setup(e){const n=960,l=540,a=b(.003),o=new B,c=new H(75,n/l,.1,1e3),i=new V;i.setSize(n,l);const m=new W;o.add(m);let d;const y=new Y;y.load("textures/world-map.jpg",r=>{const p=new K(2.5,32,32),h=new J({map:r,dithering:!0});d=new N(p,h),m.add(d)}),z(()=>e.users,r=>{m.rotation.y=0,m.clear(),m.add(d),r.filter(p=>Boolean(p.geolocation)).forEach(p=>{const{lat:h,lng:u}=p.geolocation,s=ye(2.6,h,u);y.load(p.avatarUrl,M=>{const F=new Z(.2,32),I=new ee({map:M}),T=new N(F,I);T.position.set(s.x,s.y,s.z),m.add(T)})})},{deep:!0,immediate:!0});const k=new Q(16777215,.1);o.add(k);const f=new X(16777215,1);f.position.set(40,15,40),f.angle=Math.PI/4,f.penumbra=.1,f.decay=2,f.distance=200,f.castShadow=!0,f.shadow.mapSize.width=512,f.shadow.mapSize.height=512,f.shadow.camera.near=10,f.shadow.camera.far=200,f.shadow.focus=1,o.add(f),c.position.z=5;function _(){if(requestAnimationFrame(_),d){m.rotation.y-=a.value;for(const r of m.children)r instanceof N&&r.geometry.type==="CircleGeometry"&&(r.rotation.y+=a.value)}i.render(o,c)}return _(),E(()=>{const r=document.getElementById("canvas");r&&(r.innerHTML="",r.appendChild(i.domElement))}),{rotationSpeed:a}}});var $e=R(we,[["render",be]]);function ke(){return{searchRepositories:({search:l,token:a})=>A(`
        query searchRepositories($search: String!) {
          search(type: REPOSITORY, query: $search, first: 5) {
            nodes {
              ... on Repository {
                id
                name
                owner {
                  login
                }
                nameWithOwner
              }
            }
          }
        }
      `,{headers:{authorization:`token ${a}`},search:l}),getMentionableUsers:({owner:l,name:a,token:o,after:c=null})=>A(`
        query getMentionableUsers($owner: String!, $name: String!, $after: String) {
          repository(owner: $owner, name: $name) {
            mentionableUsers(first: 100, after: $after) {
              nodes {
                id
                login
                name
                avatarUrl
                location
                url
              }
              pageInfo {
                hasNextPage
                endCursor
              }
              totalCount
            }
          }
        }
      `,{headers:{authorization:`token ${o}`},owner:l,name:a,after:c})}}const _e={class:"h-screen grid grid-rows-[4em,1fr,32px]"},Me=t("div",{class:"header flex flex-row items-center bg-dark-800 text-light-100"},[t("div",{class:"w-16 h-16 flex justify-center items-center"},[t("a",{class:"icon-globe-alt icon-lg",href:"https://github.com/Shinigami92/github-contributors-map",title:"GitHub Contributors Map Repo",target:"_blank"})]),t("div",{class:"text-lg"},"GitHub Contributors Map")],-1),Se={class:"body overflow-auto bg-dark-100 text-light-300"},Le={class:"flex justify-center"},Ce=t("label",{for:"personal-github-token"},"Your GitHub Token:",-1),Ue=t("div",{class:"hint px-2"},[t("div",{class:"inline"},"You need a GitHub private access token:"),t("a",{class:"ml-1 text-purple-400 underline",href:"https://github.com/settings/tokens/new?description=GitHub%20Contributors%20Map&scopes=public_repo",target:"_blank"},"Generate a personal token")],-1),xe={class:"flex justify-center"},Pe=t("label",{for:"search-repo"},"Search Repo:",-1),Ne={id:"repositories"},Re=t("option",{value:"2D"},"2D",-1),Te=t("option",{value:"3D"},"3D",-1),je=t("option",{value:"table"},"Table",-1),ze=[Re,Te,je],Ee=t("div",{class:"flex justify-center"},[t("button",{class:"border-2 border-purple-500 rounded-1xl px-2 py-1",type:"submit"},"Search")],-1),Oe={key:0,class:"flex justify-center"},Ge={key:2},qe=t("thead",null,[t("tr",null,[t("th",null,"Avatar"),t("th",null,"Login"),t("th",null,"Name"),t("th",null,"Location"),t("th",null,"URL"),t("th",null,"Geolocation")])],-1),Ae=["src"],De=["textContent"],Fe={class:"footer flex items-center px-2 bg-dark-800 text-light-100"},Ie={class:"text-base"};function Be(e,n,l,a,o,c){const i=O("FlatMap"),m=O("ThreeCanvas");return g(),v("div",_e,[Me,t("div",Se,[t("form",{class:"grid grid-col-3 gap-y-4 mb-4",onSubmit:n[3]||(n[3]=oe((...d)=>e.submit&&e.submit(...d),["prevent"]))},[t("div",Le,[Ce,C(t("input",{class:"w-390px ml-2 px-1 bg-true-gray-100 text-dark-900 border border-purple-500",id:"personal-github-token","onUpdate:modelValue":n[0]||(n[0]=d=>e.githubToken=d),name:"personal-github-token",placeholder:"ghp_************************************"},null,512),[[P,e.githubToken]]),Ue]),t("div",xe,[t("div",null,[Pe,C(t("input",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1",id:"search-repo","onUpdate:modelValue":n[1]||(n[1]=d=>e.search=d),name:"search-repo",placeholder:"owner/name",list:"repositories"},null,512),[[P,e.search]]),t("datalist",Ne,[(g(!0),v(S,null,U(e.repositories,d=>(g(),v("option",{key:d},w(d),1))),128))])]),t("div",null,[C(t("select",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1","onUpdate:modelValue":n[2]||(n[2]=d=>e.mode=d)},ze,512),[[ne,e.mode]])])]),Ee],32),e.errorMessage?(g(),v("span",{key:1,textContent:w(e.errorMessage)},null,8,De)):(g(),v("div",Oe,[e.mode==="2D"?(g(),G(i,{key:0,users:e.collaborators},null,8,["users"])):L("",!0),e.mode==="3D"?(g(),G(m,{key:1,users:e.collaborators},null,8,["users"])):L("",!0),e.mode==="table"?(g(),v("table",Ge,[qe,t("tbody",null,[(g(!0),v(S,null,U(e.collaborators,d=>(g(),v("tr",{key:d.id},[t("td",null,[t("img",{src:d.avatarUrl,width:"128"},null,8,Ae)]),t("td",null,w(d.login),1),t("td",null,w(d.name),1),t("td",null,w(d.location),1),t("td",null,w(d.url),1),t("td",null,w(d.geolocation),1)]))),128))])])):L("",!0)]))]),t("div",Fe,[t("div",Ie,"Currently showing "+w(e.collaborators.length)+" contributors.",1)])])}function $(e,n,l){console.debug(`Found (${e}): ${n.name}, "${n.location}" -> "${l.city}", "${l.adminName}", "${l.country}" (${l.lat}, ${l.lng})`)}const He=x({name:"App",components:{FlatMap:he,ThreeCanvas:$e},setup(){const e=b(""),n=b("vitejs/vite"),l=q(()=>{var r;return(r=n.value.split("/")[0])!=null?r:""}),a=q(()=>{var r;return(r=n.value.split("/")[1])!=null?r:""}),{searchRepositories:o,getMentionableUsers:c}=ke(),i=b([]),m=b([]),d=b("2D"),y=b(),k=[],f=r=>{let p;const{location:h}=r;if(!h)return p;let u=999;for(const s of k)s.city===h&&u>1?(p={lat:s.lat,lng:s.lng},u=1,$(u,r,s)):s.adminName===h&&u>2?(p={lat:s.lat,lng:s.lng},u=2,$(u,r,s)):s.country===h&&u>3?(p={lat:s.lat,lng:s.lng},u=3,$(u,r,s)):h.includes(s.city)&&u>4?(p={lat:s.lat,lng:s.lng},u=4,$(u,r,s)):s.adminName&&h.includes(s.adminName)&&u>5?(p={lat:s.lat,lng:s.lng},u=5,$(u,r,s)):h.includes(s.country)&&u>6&&(p={lat:s.lat,lng:s.lng},u=6,$(u,r,s));return p},_=async()=>{if(m.value=[],y.value=void 0,!(!e.value||!l.value||!a.value))try{let r=!0,p=null;const h=[];do{const u=await c({owner:l.value,name:a.value,token:e.value,after:p});r=u.repository.mentionableUsers.pageInfo.hasNextPage,p=u.repository.mentionableUsers.pageInfo.endCursor;const s=u.repository.mentionableUsers.nodes;if(s.length>0){for(const M of s)M.geolocation=f(M);h.push(...s)}}while(r);m.value=h}catch(r){console.error(r),r instanceof Error&&(y.value=r.message)}};return z([e,n],async([r,p])=>{if(i.value=[],y.value=void 0,!(!r||!p))try{const h=await o({token:r,search:p});i.value=h.search.nodes.map(u=>u.nameWithOwner)}catch(h){console.error(h),h instanceof Error&&(y.value=h.message)}}),E(()=>{le(()=>import("./worldcities.46d1bbb9.js"),[]).then(r=>{k.push(...r.default)})}),{githubToken:e,search:n,repositories:i,mode:d,collaborators:m,errorMessage:y,submit:_}}});var Ve=R(He,[["render",Be]]);re(Ve).mount("#app");

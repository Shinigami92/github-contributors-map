import{d as e,r as t,c as n,a,F as r,b as o,o as s,e as l,S as i,P as u,W as d,O as c,T as p,f as h,M as m,g,w as b,A as v,h as f,i as y,C as w,j as k,V as x,k as S,v as $,l as M,m as C,n as U,t as z,p as j,q as T}from"./vendor.227b498b.js";import{graphql as E}from"https://cdn.skypack.dev/@octokit/graphql";let L;const R={};var _=e({name:"FlatMap",props:{users:{type:Array,required:!0}},setup:()=>({width:t(960),height:t(483),avatarSize:t(24),inverseLerp:(e,t,n)=>(n-e)/(t-e)})});const q={class:"relative"};_.render=function(e,t,i,u,d,c){return s(),n("div",q,[a("img",{class:"relative",src:"https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg",style:{width:`${e.width}px`,height:`${e.height}px`}},null,4),(s(!0),n(r,null,o(e.users,(t=>(s(),n(r,null,[t.geolocation?(s(),n("img",{key:0,class:"absolute",src:t.avatarUrl,style:{top:e.inverseLerp(90,-90,t.geolocation.lat)*e.height-e.avatarSize/2+"px",left:e.inverseLerp(-180,180,t.geolocation.lng)*e.width-e.avatarSize/2+"px"},width:e.avatarSize,height:e.avatarSize},null,12,["src","width","height"])):l("",!0)],64)))),256))])};var P=e({name:"ThreeCanvas",props:{users:{type:Array,required:!0}},setup(e){const n=t(.003),a=new i,r=new u(75,960/540,.1,1e3),o=new d;o.setSize(960,540);const s=new c;let l;a.add(s);const S=new p;S.load("textures/world-map.jpg",(e=>{const t=new h(2.5,32,32),n=new m({map:e,dithering:!0});l=new g(t,n),s.add(l)})),b((()=>e.users),(e=>{s.rotation.y=0,s.clear(),s.add(l),e.filter((e=>Boolean(e.geolocation))).forEach((e=>{const{lat:t,lng:n}=e.geolocation,a=function(e,t,n){const a=(90-t)*(Math.PI/180),r=(n+180)*(Math.PI/180),o=new x;return o.x=-e*Math.sin(a)*Math.cos(r),o.z=e*Math.sin(a)*Math.sin(r),o.y=e*Math.cos(a),o}(2.6,t,n);S.load(e.avatarUrl,(e=>{const t=new w(.2,32),n=new k({map:e}),r=new g(t,n);r.position.set(a.x,a.y,a.z),s.add(r)}))}))}),{deep:!0,immediate:!0});const $=new v(16777215,.1);a.add($);const M=new f(16777215,1);return M.position.set(40,15,40),M.angle=Math.PI/4,M.penumbra=.1,M.decay=2,M.distance=200,M.castShadow=!0,M.shadow.mapSize.width=512,M.shadow.mapSize.height=512,M.shadow.camera.near=10,M.shadow.camera.far=200,M.shadow.focus=1,a.add(M),r.position.z=5,function e(){if(requestAnimationFrame(e),l){s.rotation.y-=n.value;for(const e of s.children)e instanceof g&&"CircleGeometry"===e.geometry.type&&(e.rotation.y+=n.value)}o.render(a,r)}(),y((()=>{const e=document.getElementById("canvas");e&&(e.innerHTML="",e.appendChild(o.domElement))})),{rotationSpeed:n}}});const I={class:"flex flex-col"},D=a("div",{id:"canvas"},null,-1),G={class:"mt-2"},A=a("label",{for:"rotation-speed"},"Rotation speed:",-1);function N(e,t,n){console.debug(`Found (${e}): ${t.name}, "${t.location}" -> "${n.city}", "${n.adminName}", "${n.country}" (${n.lat}, ${n.lng})`)}P.render=function(e,t,r,o,l,i){return s(),n("div",I,[D,a("div",G,[A,S(a("input",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1",id:"rotation-speed","onUpdate:modelValue":t[1]||(t[1]=t=>e.rotationSpeed=t),name:"rotation-speed",type:"number",placeholder:"0.001",step:"0.0001"},null,512),[[$,e.rotationSpeed,void 0,{number:!0}]])])])};var O=e({name:"App",components:{FlatMap:_,ThreeCanvas:P},setup(){const e=t(""),n=t("vitejs/vite"),a=M((()=>{var e;return null!=(e=n.value.split("/")[0])?e:""})),r=M((()=>{var e;return null!=(e=n.value.split("/")[1])?e:""})),{searchRepositories:o,getMentionableUsers:s}={searchRepositories:({search:e,token:t})=>E("\n        query searchRepositories($search: String!) {\n          search(type: REPOSITORY, query: $search, first: 5) {\n            nodes {\n              ... on Repository {\n                id\n                name\n                owner {\n                  login\n                }\n                nameWithOwner\n              }\n            }\n          }\n        }\n      ",{headers:{authorization:`token ${t}`},search:e}),getMentionableUsers:({owner:e,name:t,token:n,after:a=null})=>E("\n        query getMentionableUsers($owner: String!, $name: String!, $after: String) {\n          repository(owner: $owner, name: $name) {\n            mentionableUsers(first: 100, after: $after) {\n              nodes {\n                id\n                login\n                name\n                avatarUrl\n                location\n                url\n              }\n              pageInfo {\n                hasNextPage\n                endCursor\n              }\n              totalCount\n            }\n          }\n        }\n      ",{headers:{authorization:`token ${n}`},owner:e,name:t,after:a})},l=t([]),i=t([]),u=t("2D"),d=t(),c=[],p=e=>{let t;const{location:n}=e;if(!n)return t;let a=999;for(const r of c)r.city===n&&a>1?(t={lat:r.lat,lng:r.lng},a=1,N(a,e,r)):r.adminName===n&&a>2?(t={lat:r.lat,lng:r.lng},a=2,N(a,e,r)):r.country===n&&a>3?(t={lat:r.lat,lng:r.lng},a=3,N(a,e,r)):n.includes(r.city)&&a>4?(t={lat:r.lat,lng:r.lng},a=4,N(a,e,r)):r.adminName&&n.includes(r.adminName)&&a>5?(t={lat:r.lat,lng:r.lng},a=5,N(a,e,r)):n.includes(r.country)&&a>6&&(t={lat:r.lat,lng:r.lng},a=6,N(a,e,r));return t};return b([e,n],(async([e,t])=>{if(l.value=[],d.value=void 0,e&&t)try{const n=await o({token:e,search:t});l.value=n.search.nodes.map((e=>e.nameWithOwner))}catch(n){console.error(n),d.value=n.message}})),y((()=>{(function(e,t){if(!t||0===t.length)return e();if(void 0===L){const e=document.createElement("link").relList;L=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if((e=`/github-contributors-map/${e}`)in R)return;R[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":L,t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("error",t)})):void 0}))).then((()=>e()))})((()=>import("./worldcities.46d1bbb9.js")),[]).then((e=>{c.push(...e.default)}))})),{githubToken:e,search:n,repositories:l,mode:u,collaborators:i,errorMessage:d,submit:async()=>{if(i.value=[],d.value=void 0,e.value&&a.value&&r.value)try{let t=!0,n=null;const o=[];do{const l=await s({owner:a.value,name:r.value,token:e.value,after:n});t=l.repository.mentionableUsers.pageInfo.hasNextPage,n=l.repository.mentionableUsers.pageInfo.endCursor;const i=l.repository.mentionableUsers.nodes;if(i.length>0){for(const e of i)e.geolocation=p(e);o.push(...i)}}while(t);i.value=o}catch(t){console.error(t),d.value=t.message}}}}});const F={class:"h-screen grid grid-rows-[4em,1fr,32px]"},H=a("div",{class:"header flex flex-row items-center bg-dark-800 text-light-100"},[a("div",{class:"w-16 h-16 flex justify-center items-center"},[a("a",{class:"icon-globe-alt icon-lg",href:"https://github.com/Shinigami92/github-contributors-map",title:"GitHub Contributors Map Repo",target:"_blank"})]),a("div",{class:"text-lg"},"GitHub Contributors Map")],-1),V={class:"body overflow-auto bg-dark-100 text-light-300"},W={class:"flex justify-center"},Y=a("label",{for:"personal-github-token"},"Your GitHub Token:",-1),B=a("div",{class:"hint px-2"},[a("div",{class:"inline"},"You need a GitHub private access token:"),a("a",{class:"ml-1 text-purple-400 underline",href:"https://github.com/settings/tokens/new?description=GitHub%20Contributors%20Map&scopes=public_repo",target:"_blank"},"Generate a personal token")],-1),J={class:"flex justify-center"},K=a("label",{for:"search-repo"},"Search Repo:",-1),Q={id:"repositories"},X=a("option",{value:"2D"},"2D",-1),Z=a("option",{value:"3D"},"3D",-1),ee=a("option",{value:"table"},"Table",-1),te=a("div",{class:"flex justify-center"},[a("button",{class:"border-2 border-purple-500 rounded-1xl px-2 py-1",type:"submit"},"Search")],-1),ne={key:0,class:"flex justify-center"},ae={key:2},re=a("thead",null,[a("tr",null,[a("th",null,"Avatar"),a("th",null,"Login"),a("th",null,"Name"),a("th",null,"Location"),a("th",null,"URL"),a("th",null,"Geolocation")])],-1),oe={class:"footer flex items-center px-2 bg-dark-800 text-light-100"},se={class:"text-base"};O.render=function(e,t,i,u,d,c){const p=j("FlatMap"),h=j("ThreeCanvas");return s(),n("div",F,[H,a("div",V,[a("form",{class:"grid grid-col-3 gap-y-4 mb-4",onSubmit:t[4]||(t[4]=C(((...t)=>e.submit&&e.submit(...t)),["prevent"]))},[a("div",W,[Y,S(a("input",{class:"w-390px ml-2 px-1 bg-true-gray-100 text-dark-900 border border-purple-500",id:"personal-github-token","onUpdate:modelValue":t[1]||(t[1]=t=>e.githubToken=t),name:"personal-github-token",placeholder:"ghp_************************************"},null,512),[[$,e.githubToken]]),B]),a("div",J,[a("div",null,[K,S(a("input",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1",id:"search-repo","onUpdate:modelValue":t[2]||(t[2]=t=>e.search=t),name:"search-repo",placeholder:"owner/name",list:"repositories"},null,512),[[$,e.search]]),a("datalist",Q,[(s(!0),n(r,null,o(e.repositories,(e=>(s(),n("option",null,z(e),1)))),256))])]),a("div",null,[S(a("select",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1","onUpdate:modelValue":t[3]||(t[3]=t=>e.mode=t)},[X,Z,ee],512),[[U,e.mode]])])]),te],32),e.errorMessage?(s(),n("span",{key:1,textContent:z(e.errorMessage)},null,8,["textContent"])):(s(),n("div",ne,["2D"===e.mode?(s(),n(p,{key:0,users:e.collaborators},null,8,["users"])):l("",!0),"3D"===e.mode?(s(),n(h,{key:1,users:e.collaborators},null,8,["users"])):l("",!0),"table"===e.mode?(s(),n("table",ae,[re,a("tbody",null,[(s(!0),n(r,null,o(e.collaborators,(e=>(s(),n("tr",{key:e.id},[a("td",null,[a("img",{src:e.avatarUrl,width:"128"},null,8,["src"])]),a("td",null,z(e.login),1),a("td",null,z(e.name),1),a("td",null,z(e.location),1),a("td",null,z(e.url),1),a("td",null,z(e.geolocation),1)])))),128))])])):l("",!0)]))]),a("div",oe,[a("div",se,"Currently showing "+z(e.collaborators.length)+" contributors.",1)])])},T(O).mount("#app");

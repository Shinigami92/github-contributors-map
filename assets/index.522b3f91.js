import{d as e,r as t,c as n,a as r,n as a,F as o,b as s,o as l,e as i,S as c,P as u,W as d,O as p,T as h,f as m,M as g,g as f,w as b,A as v,h as y,i as w,C as k,j as x,V as S,k as M,v as $,l as C,m as U,p as L,q as z,s as E,t as j,u as T}from"./vendor.c9d43584.js";import{graphql as q}from"https://cdn.skypack.dev/@octokit/graphql";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const P={};var R=e({name:"FlatMap",props:{users:{type:Array,required:!0}},setup:()=>({width:t(960),height:t(483),avatarSize:t(24),inverseLerp:(e,t,n)=>(n-e)/(t-e)})});const _={class:"relative"},I=["src","width","height"];R.render=function(e,t,c,u,d,p){return l(),n("div",_,[r("img",{class:"relative",src:"https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg",style:a({width:`${e.width}px`,height:`${e.height}px`})},null,4),(l(!0),n(o,null,s(e.users,(t=>(l(),n(o,null,[t.geolocation?(l(),n("img",{key:0,class:"absolute",src:t.avatarUrl,style:a({top:e.inverseLerp(90,-90,t.geolocation.lat)*e.height-e.avatarSize/2+"px",left:e.inverseLerp(-180,180,t.geolocation.lng)*e.width-e.avatarSize/2+"px"}),width:e.avatarSize,height:e.avatarSize},null,12,I)):i("",!0)],64)))),256))])};var N=e({name:"ThreeCanvas",props:{users:{type:Array,required:!0}},setup(e){const n=t(.003),r=new c,a=new u(75,960/540,.1,1e3),o=new d;o.setSize(960,540);const s=new p;let l;r.add(s);const i=new h;i.load("textures/world-map.jpg",(e=>{const t=new m(2.5,32,32),n=new g({map:e,dithering:!0});l=new f(t,n),s.add(l)})),b((()=>e.users),(e=>{s.rotation.y=0,s.clear(),s.add(l),e.filter((e=>Boolean(e.geolocation))).forEach((e=>{const{lat:t,lng:n}=e.geolocation,r=function(e,t,n){const r=(90-t)*(Math.PI/180),a=(n+180)*(Math.PI/180),o=new S;return o.x=-e*Math.sin(r)*Math.cos(a),o.z=e*Math.sin(r)*Math.sin(a),o.y=e*Math.cos(r),o}(2.6,t,n);i.load(e.avatarUrl,(e=>{const t=new k(.2,32),n=new x({map:e}),a=new f(t,n);a.position.set(r.x,r.y,r.z),s.add(a)}))}))}),{deep:!0,immediate:!0});const M=new v(16777215,.1);r.add(M);const $=new y(16777215,1);return $.position.set(40,15,40),$.angle=Math.PI/4,$.penumbra=.1,$.decay=2,$.distance=200,$.castShadow=!0,$.shadow.mapSize.width=512,$.shadow.mapSize.height=512,$.shadow.camera.near=10,$.shadow.camera.far=200,$.shadow.focus=1,r.add($),a.position.z=5,function e(){if(requestAnimationFrame(e),l){s.rotation.y-=n.value;for(const e of s.children)e instanceof f&&"CircleGeometry"===e.geometry.type&&(e.rotation.y+=n.value)}o.render(r,a)}(),w((()=>{const e=document.getElementById("canvas");e&&(e.innerHTML="",e.appendChild(o.domElement))})),{rotationSpeed:n}}});const A={class:"flex flex-col"},D=r("div",{id:"canvas"},null,-1),G={class:"mt-2"},O=r("label",{for:"rotation-speed"},"Rotation speed:",-1);function F(e,t,n){console.debug(`Found (${e}): ${t.name}, "${t.location}" -> "${n.city}", "${n.adminName}", "${n.country}" (${n.lat}, ${n.lng})`)}N.render=function(e,t,a,o,s,i){return l(),n("div",A,[D,r("div",G,[O,M(r("input",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1",id:"rotation-speed","onUpdate:modelValue":t[0]||(t[0]=t=>e.rotationSpeed=t),name:"rotation-speed",type:"number",placeholder:"0.001",step:"0.0001"},null,512),[[$,e.rotationSpeed,void 0,{number:!0}]])])])};var H=e({name:"App",components:{FlatMap:R,ThreeCanvas:N},setup(){const e=t(""),n=t("vitejs/vite"),r=C((()=>{var e;return null!=(e=n.value.split("/")[0])?e:""})),a=C((()=>{var e;return null!=(e=n.value.split("/")[1])?e:""})),{searchRepositories:o,getMentionableUsers:s}={searchRepositories:({search:e,token:t})=>q("\n        query searchRepositories($search: String!) {\n          search(type: REPOSITORY, query: $search, first: 5) {\n            nodes {\n              ... on Repository {\n                id\n                name\n                owner {\n                  login\n                }\n                nameWithOwner\n              }\n            }\n          }\n        }\n      ",{headers:{authorization:`token ${t}`},search:e}),getMentionableUsers:({owner:e,name:t,token:n,after:r=null})=>q("\n        query getMentionableUsers($owner: String!, $name: String!, $after: String) {\n          repository(owner: $owner, name: $name) {\n            mentionableUsers(first: 100, after: $after) {\n              nodes {\n                id\n                login\n                name\n                avatarUrl\n                location\n                url\n              }\n              pageInfo {\n                hasNextPage\n                endCursor\n              }\n              totalCount\n            }\n          }\n        }\n      ",{headers:{authorization:`token ${n}`},owner:e,name:t,after:r})},l=t([]),i=t([]),c=t("2D"),u=t(),d=[],p=e=>{let t;const{location:n}=e;if(!n)return t;let r=999;for(const a of d)a.city===n&&r>1?(t={lat:a.lat,lng:a.lng},r=1,F(r,e,a)):a.adminName===n&&r>2?(t={lat:a.lat,lng:a.lng},r=2,F(r,e,a)):a.country===n&&r>3?(t={lat:a.lat,lng:a.lng},r=3,F(r,e,a)):n.includes(a.city)&&r>4?(t={lat:a.lat,lng:a.lng},r=4,F(r,e,a)):a.adminName&&n.includes(a.adminName)&&r>5?(t={lat:a.lat,lng:a.lng},r=5,F(r,e,a)):n.includes(a.country)&&r>6&&(t={lat:a.lat,lng:a.lng},r=6,F(r,e,a));return t};return b([e,n],(async([e,t])=>{if(l.value=[],u.value=void 0,e&&t)try{const n=await o({token:e,search:t});l.value=n.search.nodes.map((e=>e.nameWithOwner))}catch(n){console.error(n),n instanceof Error&&(u.value=n.message)}})),w((()=>{var e,t;(e=()=>import("./worldcities.46d1bbb9.js"),t=[],t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/github-contributors-map/${e}`)in P)return;P[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise(((e,t)=>{r.addEventListener("load",e),r.addEventListener("error",t)})):void 0}))).then((()=>e())):e()).then((e=>{d.push(...e.default)}))})),{githubToken:e,search:n,repositories:l,mode:c,collaborators:i,errorMessage:u,submit:async()=>{if(i.value=[],u.value=void 0,e.value&&r.value&&a.value)try{let t=!0,n=null;const o=[];do{const l=await s({owner:r.value,name:a.value,token:e.value,after:n});t=l.repository.mentionableUsers.pageInfo.hasNextPage,n=l.repository.mentionableUsers.pageInfo.endCursor;const i=l.repository.mentionableUsers.nodes;if(i.length>0){for(const e of i)e.geolocation=p(e);o.push(...i)}}while(t);i.value=o}catch(t){console.error(t),t instanceof Error&&(u.value=t.message)}}}}});const V={class:"h-screen grid grid-rows-[4em,1fr,32px]"},W=r("div",{class:"header flex flex-row items-center bg-dark-800 text-light-100"},[r("div",{class:"w-16 h-16 flex justify-center items-center"},[r("a",{class:"icon-globe-alt icon-lg",href:"https://github.com/Shinigami92/github-contributors-map",title:"GitHub Contributors Map Repo",target:"_blank"})]),r("div",{class:"text-lg"},"GitHub Contributors Map")],-1),Y={class:"body overflow-auto bg-dark-100 text-light-300"},B={class:"flex justify-center"},K=r("label",{for:"personal-github-token"},"Your GitHub Token:",-1),J=r("div",{class:"hint px-2"},[r("div",{class:"inline"},"You need a GitHub private access token:"),r("a",{class:"ml-1 text-purple-400 underline",href:"https://github.com/settings/tokens/new?description=GitHub%20Contributors%20Map&scopes=public_repo",target:"_blank"},"Generate a personal token")],-1),Q={class:"flex justify-center"},X=r("label",{for:"search-repo"},"Search Repo:",-1),Z={id:"repositories"},ee=[r("option",{value:"2D"},"2D",-1),r("option",{value:"3D"},"3D",-1),r("option",{value:"table"},"Table",-1)],te=r("div",{class:"flex justify-center"},[r("button",{class:"border-2 border-purple-500 rounded-1xl px-2 py-1",type:"submit"},"Search")],-1),ne={key:0,class:"flex justify-center"},re={key:2},ae=r("thead",null,[r("tr",null,[r("th",null,"Avatar"),r("th",null,"Login"),r("th",null,"Name"),r("th",null,"Location"),r("th",null,"URL"),r("th",null,"Geolocation")])],-1),oe=["src"],se=["textContent"],le={class:"footer flex items-center px-2 bg-dark-800 text-light-100"},ie={class:"text-base"};H.render=function(e,t,a,c,u,d){const p=U("FlatMap"),h=U("ThreeCanvas");return l(),n("div",V,[W,r("div",Y,[r("form",{class:"grid grid-col-3 gap-y-4 mb-4",onSubmit:t[3]||(t[3]=L(((...t)=>e.submit&&e.submit(...t)),["prevent"]))},[r("div",B,[K,M(r("input",{class:"w-390px ml-2 px-1 bg-true-gray-100 text-dark-900 border border-purple-500",id:"personal-github-token","onUpdate:modelValue":t[0]||(t[0]=t=>e.githubToken=t),name:"personal-github-token",placeholder:"ghp_************************************"},null,512),[[$,e.githubToken]]),J]),r("div",Q,[r("div",null,[X,M(r("input",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1",id:"search-repo","onUpdate:modelValue":t[1]||(t[1]=t=>e.search=t),name:"search-repo",placeholder:"owner/name",list:"repositories"},null,512),[[$,e.search]]),r("datalist",Z,[(l(!0),n(o,null,s(e.repositories,(e=>(l(),n("option",null,j(e),1)))),256))])]),r("div",null,[M(r("select",{class:"ml-2 bg-true-gray-100 text-dark-900 border border-purple-500 px-1","onUpdate:modelValue":t[2]||(t[2]=t=>e.mode=t)},ee,512),[[z,e.mode]])])]),te],32),e.errorMessage?(l(),n("span",{key:1,textContent:j(e.errorMessage)},null,8,se)):(l(),n("div",ne,["2D"===e.mode?(l(),E(p,{key:0,users:e.collaborators},null,8,["users"])):i("",!0),"3D"===e.mode?(l(),E(h,{key:1,users:e.collaborators},null,8,["users"])):i("",!0),"table"===e.mode?(l(),n("table",re,[ae,r("tbody",null,[(l(!0),n(o,null,s(e.collaborators,(e=>(l(),n("tr",{key:e.id},[r("td",null,[r("img",{src:e.avatarUrl,width:"128"},null,8,oe)]),r("td",null,j(e.login),1),r("td",null,j(e.name),1),r("td",null,j(e.location),1),r("td",null,j(e.url),1),r("td",null,j(e.geolocation),1)])))),128))])])):i("",!0)]))]),r("div",le,[r("div",ie,"Currently showing "+j(e.collaborators.length)+" contributors.",1)])])},T(H).mount("#app");

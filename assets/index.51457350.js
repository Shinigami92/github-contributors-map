import{d as e,r as n,c as t,a,F as o,b as r,o as s,e as l,S as i,P as u,W as c,O as d,T as p,f as h,M as m,g,w as v,A as b,h as f,i as w,C as y,j as k,V as S,k as $,v as M,l as C,m as U,t as z,n as x,p as E,q as L}from"./vendor.999fd233.js";import{graphql as R}from"https://cdn.skypack.dev/@octokit/graphql";let T;const _={};var q=e({name:"FlatMap",props:{users:{type:Array,required:!0}},setup:()=>({width:n(960),height:n(483),avatarSize:n(24),inverseLerp:(e,n,t)=>(t-e)/(n-e)})});const P={style:{position:"relative"}};q.render=function(e,n,i,u,c,d){return s(),t("div",P,[a("img",{src:"https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg",style:{position:"relative",width:`${e.width}px`,height:`${e.height}px`}},null,4),(s(!0),t(o,null,r(e.users,(n=>(s(),t(o,null,[n.geolocation?(s(),t("img",{key:0,src:n.avatarUrl,style:{position:"absolute",top:e.inverseLerp(90,-90,n.geolocation.lat)*e.height-e.avatarSize/2+"px",left:e.inverseLerp(-180,180,n.geolocation.lng)*e.width-e.avatarSize/2+"px"},width:e.avatarSize,height:e.avatarSize},null,12,["src","width","height"])):l("",!0)],64)))),256))])};var I=e({name:"ThreeCanvas",props:{users:{type:Array,required:!0}},setup(e){const t=n(.003),a=new i,o=new u(75,960/540,.1,1e3),r=new c;r.setSize(960,540);const s=new d;let l;a.add(s);const $=new p;$.load("textures/world-map.jpg",(e=>{const n=new h(2.5,32,32),t=new m({map:e,dithering:!0});l=new g(n,t),s.add(l)})),v((()=>e.users),(e=>{s.rotation.y=0,s.clear(),s.add(l),e.filter((e=>Boolean(e.geolocation))).forEach((e=>{const{lat:n,lng:t}=e.geolocation,a=function(e,n,t){const a=(90-n)*(Math.PI/180),o=(t+180)*(Math.PI/180),r=new S;return r.x=-e*Math.sin(a)*Math.cos(o),r.z=e*Math.sin(a)*Math.sin(o),r.y=e*Math.cos(a),r}(2.6,n,t);$.load(e.avatarUrl,(e=>{const n=new y(.2,32),t=new k({map:e}),o=new g(n,t);o.position.set(a.x,a.y,a.z),s.add(o)}))}))}),{deep:!0});const M=new b(16777215,.1);a.add(M);const C=new f(16777215,1);return C.position.set(40,15,40),C.angle=Math.PI/4,C.penumbra=.1,C.decay=2,C.distance=200,C.castShadow=!0,C.shadow.mapSize.width=512,C.shadow.mapSize.height=512,C.shadow.camera.near=10,C.shadow.camera.far=200,C.shadow.focus=1,a.add(C),o.position.z=5,function e(){if(requestAnimationFrame(e),l){s.rotation.y-=t.value;for(const e of s.children)e instanceof g&&"CircleGeometry"===e.geometry.type&&(e.rotation.y+=t.value)}r.render(a,o)}(),w((()=>{const e=document.getElementById("canvas");e&&(e.innerHTML="",e.appendChild(r.domElement))})),{rotationSpeed:t}}});const G=a("label",{for:"rotation-speed"},"Rotation speed:",-1),j=a("div",{id:"canvas"},null,-1);function A(e,n,t){console.debug(`Found (${e}): ${n.name}, "${n.location}" -> "${t.city}", "${t.adminName}", "${t.country}" (${t.lat}, ${t.lng})`)}I.render=function(e,n,r,l,i,u){return s(),t(o,null,[G,$(a("input",{id:"rotation-speed","onUpdate:modelValue":n[1]||(n[1]=n=>e.rotationSpeed=n),name:"rotation-speed",type:"number",placeholder:"0.001",step:"0.0001"},null,512),[[M,e.rotationSpeed,void 0,{number:!0}]]),j],64)};var N=e({name:"App",components:{FlatMap:q,ThreeCanvas:I},setup(){const e=n(""),t=n("vitejs/vite"),a=C((()=>{var e;return null!=(e=t.value.split("/")[0])?e:""})),o=C((()=>{var e;return null!=(e=t.value.split("/")[1])?e:""})),{searchRepositories:r,getMentionableUsers:s}={searchRepositories:({search:e,token:n})=>R("\n        query searchRepositories($search: String!) {\n          search(type: REPOSITORY, query: $search, first: 5) {\n            nodes {\n              ... on Repository {\n                id\n                name\n                owner {\n                  login\n                }\n                nameWithOwner\n              }\n            }\n          }\n        }\n      ",{headers:{authorization:`token ${n}`},search:e}),getMentionableUsers:({owner:e,name:n,token:t,after:a=null})=>R("\n        query getMentionableUsers($owner: String!, $name: String!, $after: String) {\n          repository(owner: $owner, name: $name) {\n            mentionableUsers(first: 100, after: $after) {\n              nodes {\n                id\n                login\n                name\n                avatarUrl\n                location\n                url\n              }\n              pageInfo {\n                hasNextPage\n                endCursor\n              }\n              totalCount\n            }\n          }\n        }\n      ",{headers:{authorization:`token ${t}`},owner:e,name:n,after:a})},l=n([]),i=n([]),u=n(),c=[],d=e=>{let n;const{location:t}=e;if(!t)return n;let a=999;for(const o of c)o.city===t&&a>1?(n={lat:o.lat,lng:o.lng},a=1,A(a,e,o)):o.adminName===t&&a>2?(n={lat:o.lat,lng:o.lng},a=2,A(a,e,o)):o.country===t&&a>3?(n={lat:o.lat,lng:o.lng},a=3,A(a,e,o)):t.includes(o.city)&&a>4?(n={lat:o.lat,lng:o.lng},a=4,A(a,e,o)):o.adminName&&t.includes(o.adminName)&&a>5?(n={lat:o.lat,lng:o.lng},a=5,A(a,e,o)):t.includes(o.country)&&a>6&&(n={lat:o.lat,lng:o.lng},a=6,A(a,e,o));return n};return v([e,t],(async([e,n])=>{if(l.value=[],u.value=void 0,e&&n)try{const t=await r({token:e,search:n});l.value=t.search.nodes.map((e=>e.nameWithOwner))}catch(t){console.error(t),u.value=t.message}})),w((()=>{(function(e,n){if(!n||0===n.length)return e();if(void 0===T){const e=document.createElement("link").relList;T=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(n.map((e=>{if((e=`/github-contributors-map/${e}`)in _)return;_[e]=!0;const n=e.endsWith(".css"),t=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${t}`))return;const a=document.createElement("link");return a.rel=n?"stylesheet":T,n||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),n?new Promise(((e,n)=>{a.addEventListener("load",e),a.addEventListener("error",n)})):void 0}))).then((()=>e()))})((()=>import("./worldcities.46d1bbb9.js")),[]).then((e=>{c.push(...e.default)}))})),{githubToken:e,search:t,repositories:l,collaborators:i,errorMessage:u,submit:async()=>{if(i.value=[],u.value=void 0,e.value&&a.value&&o.value)try{let n=!0,t=null;const r=[];do{const l=await s({owner:a.value,name:o.value,token:e.value,after:t});n=l.repository.mentionableUsers.pageInfo.hasNextPage,t=l.repository.mentionableUsers.pageInfo.endCursor;const i=l.repository.mentionableUsers.nodes;if(i.length>0){for(const e of i)e.geolocation=d(e);r.push(...i)}}while(n);i.value=r}catch(n){console.error(n),u.value=n.message}}}}});const O=a("h1",null,"GitHub Contributors Map",-1),F=a("p",null,[a("a",{href:"https://github.com/Shinigami92/github-contributors-map",target:"_blank"},"GitHub Repo")],-1),H=a("p",null,[x("You need a GitHub private access token: "),a("a",{href:"https://github.com/settings/tokens/new?description=GitHub%20Contributors%20Map&scopes=public_repo",target:"_blank"},"Generate a personal token")],-1),V=a("label",{for:"personal-github-token"},"Your GitHub Token:",-1),W=a("label",{for:"search-repo"},"Search Repo:",-1),Y={id:"repositories"},B=a("button",{type:"submit"},"Search",-1),D=a("h2",null,"Collaborators",-1),J=a("thead",null,[a("tr",null,[a("th",null,"Avatar"),a("th",null,"Login"),a("th",null,"Name"),a("th",null,"Location"),a("th",null,"URL"),a("th",null,"Geolocation")])],-1);N.render=function(e,n,l,i,u,c){const d=E("FlatMap"),p=E("ThreeCanvas");return s(),t(o,null,[O,a("div",null,[F,H,a("form",{onSubmit:n[3]||(n[3]=U(((...n)=>e.submit&&e.submit(...n)),["prevent"]))},[V,$(a("input",{id:"personal-github-token","onUpdate:modelValue":n[1]||(n[1]=n=>e.githubToken=n),name:"personal-github-token",placeholder:"ghp_************************************"},null,512),[[M,e.githubToken]]),W,$(a("input",{id:"search-repo","onUpdate:modelValue":n[2]||(n[2]=n=>e.search=n),name:"search-repo",placeholder:"owner/name",list:"repositories"},null,512),[[M,e.search]]),a("datalist",Y,[(s(!0),t(o,null,r(e.repositories,(e=>(s(),t("option",null,z(e),1)))),256))]),B],32)]),e.errorMessage?(s(),t("span",{key:1,textContent:z(e.errorMessage)},null,8,["textContent"])):(s(),t(o,{key:0},[D,a(d,{users:e.collaborators},null,8,["users"]),a(p,{users:e.collaborators},null,8,["users"]),a("table",null,[J,a("tbody",null,[(s(!0),t(o,null,r(e.collaborators,(e=>(s(),t("tr",{key:e.id},[a("td",null,[a("img",{src:e.avatarUrl,width:"128"},null,8,["src"])]),a("td",null,z(e.login),1),a("td",null,z(e.name),1),a("td",null,z(e.location),1),a("td",null,z(e.url),1),a("td",null,z(e.geolocation),1)])))),128))])])],64))],64)},L(N).mount("#app");
